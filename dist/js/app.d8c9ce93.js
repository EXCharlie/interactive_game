(function(){"use strict";var e={1558:function(e,t,n){var s=n(5130),a=n(6768),i=n(4232);const r={class:"min-h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900 transition-colors"};function o(e,t,n,s,o,c){const l=(0,a.g2)("StartScreen"),d=(0,a.g2)("GameScreen");return(0,a.uX)(),(0,a.CE)("div",{class:(0,i.C4)(o.theme)},[(0,a.Lk)("div",r,["start"===o.gameState?((0,a.uX)(),(0,a.Wv)(l,{key:0,theme:o.theme,onStart:c.startGame,onToggleTheme:c.toggleTheme},null,8,["theme","onStart","onToggleTheme"])):(0,a.Q3)("",!0),"play"===o.gameState?((0,a.uX)(),(0,a.Wv)(d,{key:1,sceneId:o.currentScene,theme:o.theme,manager:o.manager,typingSpeed:o.typingSpeed,onRestart:c.restartGame},null,8,["sceneId","theme","manager","typingSpeed","onRestart"])):(0,a.Q3)("",!0)])],2)}const c={class:"title"},l={class:"data-source-selector"},d={class:"typing-speed-selector"},h=["disabled"];function u(e,t,n,r,o,u){return(0,a.uX)(),(0,a.CE)("div",{class:(0,i.C4)(["container","dark"===n.theme?"dark":""])},[(0,a.Lk)("h1",c,(0,i.v_)(o.gameTitle),1),(0,a.Lk)("p",{class:(0,i.C4)(["description","dark"===n.theme?"dark":""])},(0,i.v_)(o.gameDescription),3),(0,a.Lk)("div",l,[t[6]||(t[6]=(0,a.Lk)("label",{for:"dataSource",class:"selector-label"},"选择数据源:",-1)),(0,a.bo)((0,a.Lk)("select",{id:"dataSource","onUpdate:modelValue":t[0]||(t[0]=e=>o.selectedDataSource=e),onChange:t[1]||(t[1]=(...e)=>u.loadGameData&&u.loadGameData(...e)),class:"selector"},t[5]||(t[5]=[(0,a.Lk)("option",{value:"/data/main.json"},"主数据 (main.json)",-1),(0,a.Lk)("option",{value:"/data/main copy.json"},"无法逃离的星期八demo (main copy.json)",-1)]),544),[[s.u1,o.selectedDataSource]])]),(0,a.Lk)("div",d,[t[8]||(t[8]=(0,a.Lk)("label",{for:"typingSpeed",class:"selector-label"},"选择打字速度:",-1)),(0,a.bo)((0,a.Lk)("select",{id:"typingSpeed","onUpdate:modelValue":t[2]||(t[2]=e=>o.selectedTypingSpeed=e),class:"selector"},t[7]||(t[7]=[(0,a.Lk)("option",{value:"slow"},"慢",-1),(0,a.Lk)("option",{value:"normal"},"正常",-1),(0,a.Lk)("option",{value:"fast"},"非常快",-1)]),512),[[s.u1,o.selectedTypingSpeed]])]),(0,a.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>u.startGameCombined&&u.startGameCombined(...e)),class:"btn",disabled:!o.loadedGameData}," 开始游戏 ",8,h),(0,a.Lk)("button",{onClick:t[4]||(t[4]=t=>e.$emit("toggle-theme")),class:(0,i.C4)(["btn","toggle-btn","dark"===n.theme?"dark":""])}," 切换为 "+(0,i.v_)("light"===n.theme?"深色":"浅色")+"模式 ",3)],2)}var m={props:["theme"],data(){return{gameTitle:"加载中...",gameDescription:"请选择一个数据源...",selectedDataSource:"/data/main.json",loadedGameData:null,selectedTypingSpeed:"normal"}},created(){this.loadGameData()},methods:{async loadGameData(){this.gameTitle="加载中...",this.gameDescription="请稍候...",this.loadedGameData=null;try{const e=await fetch(this.selectedDataSource);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();this.loadedGameData=t,this.gameTitle=t.metadata.title,this.gameDescription=t.metadata.description}catch(e){console.error("Failed to load game data:",e),this.gameTitle="加载失败",this.gameDescription="无法加载游戏数据。请检查文件路径或网络连接。",this.loadedGameData=null}},startGameCombined(){let e;switch(this.selectedTypingSpeed){case"slow":e=80;break;case"fast":e=0;break;case"normal":e=50;break}this.$emit("start",this.loadedGameData,e)}}},p=n(1241);const g=(0,p.A)(m,[["render",u],["__scopeId","data-v-40efc7fb"]]);var y=g;const f={class:"message-list",ref:"messageList"},v={key:0,class:"typing"},k={key:1,class:"choices"},S=["onClick"],T={key:2,class:"ending"},b={class:"ending-title"},x={class:"ending-desc"};function A(e,t,n,s,r,o){return(0,a.uX)(),(0,a.CE)("div",{class:(0,i.C4)(["container","dark"===n.theme?"dark":""]),ref:"container"},[(0,a.Lk)("div",f,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.messages,((e,t)=>((0,a.uX)(),(0,a.CE)("div",{key:t,class:(0,i.C4)(["message","choice"===e.type?"message-choice":"message-text"])},(0,i.v_)(e.content),3)))),128))],512),r.typingText?((0,a.uX)(),(0,a.CE)("div",v,(0,i.v_)(r.typingText),1)):(0,a.Q3)("",!0),"options"===r.currentAction?.type?((0,a.uX)(),(0,a.CE)("div",k,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.currentAction.options,((e,t)=>((0,a.uX)(),(0,a.CE)("button",{key:t,class:"btn choice-btn",onClick:t=>o.handleOption(e)},(0,i.v_)(e.text),9,S)))),128))])):(0,a.Q3)("",!0),"ending"===r.currentAction?.type?((0,a.uX)(),(0,a.CE)("div",T,[(0,a.Lk)("h2",b,(0,i.v_)(r.currentAction.name),1),(0,a.Lk)("p",x,(0,i.v_)(r.currentAction.description),1),(0,a.Lk)("button",{onClick:t[0]||(t[0]=t=>e.$emit("restart")),class:"btn return-btn"}," 返回开始界面 ")])):(0,a.Q3)("",!0)],2)}n(4114);var C={props:["sceneId","theme","manager","typingSpeed"],data(){return{currentActionIndex:0,currentActions:[],currentAction:null,typingText:"",messages:[],isTyping:!1}},watch:{sceneId(e){this.loadScene(e)}},mounted(){this.manager?this.loadScene(this.sceneId):(console.error("GameScreen: SceneManager prop is missing or null."),this.messages.push({content:"游戏加载失败，请返回开始界面并确保数据已选择。",type:"text"}),this.currentAction={type:"ending",name:"加载错误",description:"无法初始化游戏场景管理器。"})},methods:{loadScene(e){const t=this.manager.getScene(e);this.currentActions=t.actions,this.currentActionIndex=0,this.typingText="",this.nextAction()},nextAction(){if(this.currentActionIndex>=this.currentActions.length)return void(this.currentAction=null);const e=this.currentActions[this.currentActionIndex];this.currentAction=e,"text"===e.type?(this.typingText="",this.isTyping=!0,this.typeOut(e.content,(()=>{this.isTyping=!1,this.scrollToBottom(),this.currentActionIndex++,this.nextAction()}))):"delay"===e.type?setTimeout((()=>{this.currentActionIndex++,this.nextAction()}),e.duration||1e3):"options"===e.type||e.type},typeOut(e,t){let n=0;const s=setInterval((()=>{n<e.length?("\n"===e[n]?(this.messages.push({content:this.typingText,type:"text"}),this.typingText="",this.scrollToBottom()):this.typingText+=e[n],n++):(this.messages.push({content:this.typingText,type:"text"}),this.typingText="",this.scrollToBottom(),clearInterval(s),t())}),this.typingSpeed)},handleOption(e){this.messages.push({content:`→ 你选择了：${e.text}`,type:"choice"}),this.scrollToBottom();const t=this.manager.applyEffects(e.effects);t?this.loadScene(t):(this.currentActionIndex++,this.nextAction())},scrollToBottom(){this.$nextTick((()=>{const e=this.$refs.messageList;e&&(e.scrollTop=e.scrollHeight)}))}}};const L=(0,p.A)(C,[["render",A],["__scopeId","data-v-3762d3ea"]]);var D=L;class G{constructor(e){if(!e)return console.error("SceneManager: 必须提供 gameData 来初始化场景管理器。"),this.scenes={},this.startScene=null,this.metadata={},void(this.state={});this.gameData=e,this.scenes=e.scenes,this.metadata=e.metadata||{},this.startScene=this.metadata.startscene||Object.keys(this.scenes)[0],this.state={}}getScene(e){const t=this.scenes[e];return t||(console.error(`场景 "${e}" 未找到。`),{actions:[{type:"text",content:`错误：场景"${e}"未找到。`}],type:"ending",name:"游戏结束",description:"请联系管理员。"})}applyEffects(e){let t=null;for(const n of e){const{actionType:e}=n;if("jump"===e)t=n.targetScene;else if("update"===e)this.state[n.property]=n.value;else if("condition"===e){const e=this.state[n.test];t=e?n.trueTarget:n.falseTarget}}return t}reset(){this.state={}}}var I={components:{StartScreen:y,GameScreen:D},data(){return{gameState:"start",currentScene:"scene1",manager:null,theme:"light",typingSpeed:100}},methods:{startGame(e,t){e?(this.manager=new G(e),this.manager.reset(),this.currentScene=this.manager.startScene,this.typingSpeed=t,this.gameState="play"):console.error("游戏数据未加载，无法开始游戏。")},restartGame(){this.gameState="start",this.manager=null},toggleTheme(){this.theme="light"===this.theme?"dark":"light"}}};const w=(0,p.A)(I,[["render",o]]);var O=w;(0,s.Ef)(O).mount("#app")}},t={};function n(s){var a=t[s];if(void 0!==a)return a.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,s,a,i){if(!s){var r=1/0;for(d=0;d<e.length;d++){s=e[d][0],a=e[d][1],i=e[d][2];for(var o=!0,c=0;c<s.length;c++)(!1&i||r>=i)&&Object.keys(n.O).every((function(e){return n.O[e](s[c])}))?s.splice(c--,1):(o=!1,i<r&&(r=i));if(o){e.splice(d--,1);var l=a();void 0!==l&&(t=l)}}return t}i=i||0;for(var d=e.length;d>0&&e[d-1][2]>i;d--)e[d]=e[d-1];e[d]=[s,a,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={524:0};n.O.j=function(t){return 0===e[t]};var t=function(t,s){var a,i,r=s[0],o=s[1],c=s[2],l=0;if(r.some((function(t){return 0!==e[t]}))){for(a in o)n.o(o,a)&&(n.m[a]=o[a]);if(c)var d=c(n)}for(t&&t(s);l<r.length;l++)i=r[l],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(d)},s=self["webpackChunkinteractive_game"]=self["webpackChunkinteractive_game"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=n.O(void 0,[504],(function(){return n(1558)}));s=n.O(s)})();
//# sourceMappingURL=app.d8c9ce93.js.map