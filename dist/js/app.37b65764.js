(function(){"use strict";var t={792:function(t,e,n){var s=n(5130),i=n(6768);function a(t,e,n,s,a,o){const r=(0,i.g2)("StartScreen"),c=(0,i.g2)("GameScreen");return(0,i.uX)(),(0,i.CE)("div",null,["start"===a.gameState?((0,i.uX)(),(0,i.Wv)(r,{key:0,theme:a.theme,onStart:o.startGame,onToggleTheme:o.toggleTheme},null,8,["theme","onStart","onToggleTheme"])):(0,i.Q3)("",!0),"play"===a.gameState?((0,i.uX)(),(0,i.Wv)(c,{key:1,sceneId:a.currentScene,theme:a.theme,manager:a.manager,typingSpeed:a.typingSpeed,onRestart:o.restartGame},null,8,["sceneId","theme","manager","typingSpeed","onRestart"])):(0,i.Q3)("",!0)])}var o=n(4232);const r={class:"title"},c={class:"data-source-selector"},l={class:"typing-speed-selector"},d=["disabled"];function h(t,e,n,a,h,u){return(0,i.uX)(),(0,i.CE)("div",{class:(0,o.C4)(["container","dark"===n.theme?"dark":""])},[(0,i.Lk)("h1",r,(0,o.v_)(h.gameTitle),1),(0,i.Lk)("p",{class:(0,o.C4)(["description","dark"===n.theme?"dark":""])},(0,o.v_)(h.gameDescription),3),(0,i.Lk)("div",c,[e[6]||(e[6]=(0,i.Lk)("label",{for:"dataSource",class:"selector-label"},"选择数据源:",-1)),(0,i.bo)((0,i.Lk)("select",{id:"dataSource","onUpdate:modelValue":e[0]||(e[0]=t=>h.selectedDataSource=t),onChange:e[1]||(e[1]=(...t)=>u.loadGameData&&u.loadGameData(...t)),class:"selector"},e[5]||(e[5]=[(0,i.Lk)("option",{value:"data/main.json"},"主数据 (main.json)",-1),(0,i.Lk)("option",{value:"data/main copy.json"},"无法逃离的星期八demo (main copy.json)",-1)]),544),[[s.u1,h.selectedDataSource]])]),(0,i.Lk)("div",l,[e[8]||(e[8]=(0,i.Lk)("label",{for:"typingSpeed",class:"selector-label"},"选择打字速度:",-1)),(0,i.bo)((0,i.Lk)("select",{id:"typingSpeed","onUpdate:modelValue":e[2]||(e[2]=t=>h.selectedTypingSpeed=t),class:"selector"},e[7]||(e[7]=[(0,i.Lk)("option",{value:"slow"},"慢",-1),(0,i.Lk)("option",{value:"normal"},"正常",-1),(0,i.Lk)("option",{value:"fast"},"非常快",-1)]),512),[[s.u1,h.selectedTypingSpeed]])]),(0,i.Lk)("button",{onClick:e[3]||(e[3]=(...t)=>u.startGameCombined&&u.startGameCombined(...t)),class:"btn",disabled:!h.loadedGameData}," 开始游戏 ",8,d),(0,i.Lk)("button",{onClick:e[4]||(e[4]=e=>t.$emit("toggle-theme")),class:(0,o.C4)(["btn","toggle-btn","dark"===n.theme?"dark":""])}," 切换为 "+(0,o.v_)("light"===n.theme?"深色":"浅色")+"模式 ",3)],2)}var u={props:["theme"],data(){return{gameTitle:"加载中...",gameDescription:"请选择一个数据源...",selectedDataSource:"data/main.json",loadedGameData:null,selectedTypingSpeed:"normal"}},created(){this.loadGameData()},methods:{async loadGameData(){this.gameTitle="加载中...",this.gameDescription="请稍候...",this.loadedGameData=null;try{const t=await fetch(this.selectedDataSource);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const e=await t.json();this.loadedGameData=e,this.gameTitle=e.metadata.title,this.gameDescription=e.metadata.description}catch(t){console.error("Failed to load game data:",t),this.gameTitle="加载失败",this.gameDescription="无法加载游戏数据。请检查文件路径或网络连接。",this.loadedGameData=null}},startGameCombined(){let t;switch(this.selectedTypingSpeed){case"slow":t=60;break;case"fast":t=0;break;case"normal":t=40;break}this.$emit("start",this.loadedGameData,t)}}},m=n(1241);const p=(0,m.A)(u,[["render",h],["__scopeId","data-v-6df4421a"]]);var g=p;const y={class:"message-list",ref:"messageList"},f={key:0,class:"typing"},v={key:1,class:"choices"},k=["onClick"],S={key:2,class:"ending"},x={class:"ending-title"},T={class:"ending-desc"};function b(t,e,n,s,a,r){return(0,i.uX)(),(0,i.CE)("div",{class:(0,o.C4)(["container","dark"===n.theme?"dark":""]),ref:"container"},[(0,i.Lk)("div",y,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.messages,((t,e)=>((0,i.uX)(),(0,i.CE)("div",{key:e,class:(0,o.C4)(["message","choice"===t.type?"message-choice":"message-text"])},(0,o.v_)(t.content),3)))),128))],512),a.typingText?((0,i.uX)(),(0,i.CE)("div",f,(0,o.v_)(a.typingText),1)):(0,i.Q3)("",!0),"options"===a.currentAction?.type?((0,i.uX)(),(0,i.CE)("div",v,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(a.currentAction.options,((t,e)=>((0,i.uX)(),(0,i.CE)("button",{key:e,class:"btn choice-btn",onClick:e=>r.handleOption(t)},(0,o.v_)(t.text),9,k)))),128))])):(0,i.Q3)("",!0),"ending"===a.currentAction?.type?((0,i.uX)(),(0,i.CE)("div",S,[(0,i.Lk)("h2",x,(0,o.v_)(a.currentAction.name),1),(0,i.Lk)("p",T,(0,o.v_)(a.currentAction.description),1),(0,i.Lk)("button",{onClick:e[0]||(e[0]=e=>t.$emit("restart")),class:"btn return-btn"}," 返回开始界面 ")])):(0,i.Q3)("",!0)],2)}n(4114);var A={props:["sceneId","theme","manager","typingSpeed"],data(){return{currentActionIndex:0,currentActions:[],currentAction:null,typingText:"",messages:[],isTyping:!1}},watch:{sceneId(t){this.loadScene(t)}},mounted(){this.manager?this.loadScene(this.sceneId):(console.error("GameScreen: SceneManager prop is missing or null."),this.messages.push({content:"游戏加载失败，请返回开始界面并确保数据已选择。",type:"text"}),this.currentAction={type:"ending",name:"加载错误",description:"无法初始化游戏场景管理器。"})},methods:{loadScene(t){const e=this.manager.getScene(t);this.currentActions=e.actions,this.currentActionIndex=0,this.typingText="",this.nextAction()},nextAction(){if(this.currentActionIndex>=this.currentActions.length)return void(this.currentAction=null);const t=this.currentActions[this.currentActionIndex];if(this.currentAction=t,"text"===t.type)this.typingText="",this.isTyping=!0,this.typeOut(t.content,(()=>{this.isTyping=!1,this.scrollToBottom(),this.currentActionIndex++,this.nextAction()}));else if("delay"===t.type)setTimeout((()=>{this.currentActionIndex++,this.nextAction()}),t.duration||1e3);else if("options"===t.type||"ending"===t.type);else{if("jump"===t.type)return void(t.targetSceneId?this.loadScene(t.targetSceneId):(console.error("Jump action missing targetSceneId:",t),this.currentActionIndex++,this.nextAction()));"conditiontext"===t.type&&(this.manager&&t.condition?this.manager.evaluateCondition(t.condition)?(this.typingText="",this.isTyping=!0,t.content?this.typeOut(t.content,(()=>{this.isTyping=!1,this.scrollToBottom(),this.currentActionIndex++,this.nextAction()})):(this.isTyping=!1,this.currentActionIndex++,this.nextAction())):(this.currentActionIndex++,this.nextAction()):(console.error("Conditiontext action missing manager or condition:",t),this.currentActionIndex++,this.nextAction()))}},typeOut(t,e){let n=0;const s=setInterval((()=>{n<t.length?("\n"===t[n]?(this.messages.push({content:this.typingText,type:"text"}),this.typingText="",this.scrollToBottom()):this.typingText+=t[n],n++):(this.messages.push({content:this.typingText,type:"text"}),this.typingText="",this.scrollToBottom(),clearInterval(s),e())}),this.typingSpeed)},handleOption(t){this.messages.push({content:`→ 你选择了：${t.text}`,type:"choice"}),this.scrollToBottom();const e=this.manager.applyEffects(t.effects);e?this.loadScene(e):(this.currentActionIndex++,this.nextAction())},scrollToBottom(){this.$nextTick((()=>{const t=this.$refs.messageList;t&&(t.scrollTop=t.scrollHeight)}))}}};const C=(0,m.A)(A,[["render",b],["__scopeId","data-v-6c16df42"]]);var I=C;class L{constructor(t){if(!t)return console.error("SceneManager: 必须提供 gameData 来初始化场景管理器。"),this.scenes={},this.startScene=null,this.metadata={},void(this.state={});this.gameData=t,this.scenes=t.scenes,this.metadata=t.metadata||{},this.startScene=this.metadata.startscene||Object.keys(this.scenes)[0],this.state={}}getScene(t){const e=this.scenes[t];return e||(console.error(`场景 "${t}" 未找到。`),{actions:[{type:"text",content:`错误：场景"${t}"未找到。`}],type:"ending",name:"游戏结束",description:"请联系管理员。"})}applyEffects(t){let e=null;for(const n of t){const{actionType:t}=n;if("jump"===t)e=n.targetScene;else if("update"===t)this.state[n.property]=n.value;else if("condition"===t){const t=this.state[n.test];e=t?n.trueTarget:n.falseTarget}}return e}evaluateCondition(t){try{const e=/^(\w+)\s*(===|!==|<=|<|>=|>)\s*(.+)$/,n=t.match(e);if(!n)return"undefined"!==typeof this.state[t]?!!this.state[t]:(console.warn(`Could not parse condition or unknown state property: ${t}`),!1);{const t=n[1],e=n[2];let s,i=n[3].trim();s=i.startsWith("'")&&i.endsWith("'")||i.startsWith('"')&&i.endsWith('"')?i.slice(1,-1):!isNaN(parseFloat(i))&&isFinite(i)?parseFloat(i):"true"===i||"false"===i?"true"===i:i;const a=this.state[t];switch(e){case"===":return a===s;case"!==":return a!==s;case"<=":return a<=s;case"<":return a<s;case">=":return a>=s;case">":return a>s;default:return console.warn(`Unsupported operator in condition: ${e}`),!1}}}catch(e){return console.error(`Error evaluating condition "${t}":`,e),!1}}reset(){this.state={}}}var w={components:{StartScreen:g,GameScreen:I},data(){return{gameState:"start",currentScene:"scene1",manager:null,theme:"light",typingSpeed:100}},watch:{theme(t){"dark"===t?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")}},mounted(){"dark"===this.theme?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")},methods:{startGame(t,e){t?(this.manager=new L(t),this.manager.reset(),this.currentScene=this.manager.startScene,this.typingSpeed=e,this.gameState="play"):console.error("游戏数据未加载，无法开始游戏。")},restartGame(){this.gameState="start",this.manager=null},toggleTheme(){this.theme="light"===this.theme?"dark":"light"}}};const D=(0,m.A)(w,[["render",a]]);var G=D;(0,s.Ef)(G).mount("#app")}},e={};function n(s){var i=e[s];if(void 0!==i)return i.exports;var a=e[s]={exports:{}};return t[s].call(a.exports,a,a.exports,n),a.exports}n.m=t,function(){var t=[];n.O=function(e,s,i,a){if(!s){var o=1/0;for(d=0;d<t.length;d++){s=t[d][0],i=t[d][1],a=t[d][2];for(var r=!0,c=0;c<s.length;c++)(!1&a||o>=a)&&Object.keys(n.O).every((function(t){return n.O[t](s[c])}))?s.splice(c--,1):(r=!1,a<o&&(o=a));if(r){t.splice(d--,1);var l=i();void 0!==l&&(e=l)}}return e}a=a||0;for(var d=t.length;d>0&&t[d-1][2]>a;d--)t[d]=t[d-1];t[d]=[s,i,a]}}(),function(){n.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return n.d(e,{a:e}),e}}(),function(){n.d=function(t,e){for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={524:0};n.O.j=function(e){return 0===t[e]};var e=function(e,s){var i,a,o=s[0],r=s[1],c=s[2],l=0;if(o.some((function(e){return 0!==t[e]}))){for(i in r)n.o(r,i)&&(n.m[i]=r[i]);if(c)var d=c(n)}for(e&&e(s);l<o.length;l++)a=o[l],n.o(t,a)&&t[a]&&t[a][0](),t[a]=0;return n.O(d)},s=self["webpackChunkinteractive_game"]=self["webpackChunkinteractive_game"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=n.O(void 0,[504],(function(){return n(792)}));s=n.O(s)})();
//# sourceMappingURL=app.37b65764.js.map